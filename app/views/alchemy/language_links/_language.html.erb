<% css_classes = [language.code] %>
<% css_classes << 'active' if Alchemy::Language.current.id == language.id %>
<% css_classes << 'first' if languages.first == language %>
<% css_classes << 'last' if languages.last == language %>
<% link_title = options[:show_title] ? _t("#{language.code}.title", scope: 'language_links', default: language.name) : nil %>
<% dst_page = Alchemy::Page.where(page_layout: @page.try(:page_layout), language_code: language.code).take || language.pages.language_roots.first %>

<%= link_to(
      content_tag(:span, language.label(options[:linkname])).html_safe,
      show_alchemy_page_path(dst_page, locale: language.code),
      class: css_classes.join(" "),
      title: link_title
    ) %>
